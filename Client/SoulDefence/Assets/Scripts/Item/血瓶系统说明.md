# 血瓶系统实现说明

## 文件结构

```
Item/
├── HealthPotionData.cs         # 血瓶配置数据（ScriptableObject）
├── HealthPotionInstance.cs     # 血瓶实例（运行时状态）
└── HealthPotionSystem.cs       # 血瓶系统（管理使用和冷却）
```

## 核心类说明

### 1. HealthPotionData
血瓶配置数据（ScriptableObject）：
- 血瓶ID和名称
- 恢复百分比（0-100%）
- 冷却时间
- 使用限制（是否允许满血使用）

**创建方式**：
右键 -> Create -> GameConfig -> Item -> Health Potion

### 2. HealthPotionInstance
血瓶实例，管理运行时状态：
- 冷却计时
- 冷却状态查询
- 冷却百分比计算

### 3. HealthPotionSystem
血瓶系统管理类：
- 初始化血瓶
- 使用血瓶
- 更新冷却
- 提供使用接口

## 使用方式

### 配置实体血瓶

在Unity编辑器中选择GameEntity：
1. 展开 `Health Potion System`
2. 将血瓶配置拖到 `Initial Potion` 槽位
3. 如果不配置则实体没有血瓶

### 使用血瓶

```csharp
// 获取实体
GameEntity entity = GetComponent<GameEntity>();

// 使用血瓶
bool success = entity.UseHealthPotion();

// 检查是否可用
bool canUse = entity.HealthPotionSystem.CanUse();

// 获取冷却信息
float remaining = entity.HealthPotionSystem.GetCooldownRemaining();
float percent = entity.HealthPotionSystem.GetCooldownPercent();
bool isOnCooldown = entity.HealthPotionSystem.IsOnCooldown();

// 检查是否有血瓶
bool hasPotion = entity.HealthPotionSystem.HasPotion();
```

## 配置示例

### 小型生命药水
```
potionId: 3001
potionName: 小型生命药水
healPercentage: 33
cooldownTime: 15
startOnCooldown: false
allowUseWhenFull: false
```

### 大型生命药水
```
potionId: 3002
potionName: 大型生命药水
healPercentage: 50
cooldownTime: 30
startOnCooldown: false
allowUseWhenFull: false
```

## 使用条件

血瓶使用需要满足以下所有条件：
1. ✅ 实体存活
2. ✅ 拥有血瓶（配置了血瓶数据）
3. ✅ 不在冷却中
4. ✅ 生命值未满（如果不允许满血使用）

## 集成说明

### 已集成到 GameEntity
- ✅ 自动初始化
- ✅ 自动更新冷却
- ✅ 提供 `UseHealthPotion()` 接口
- ✅ 支持没有血瓶的情况

### 使用流程
1. 调用 `UseHealthPotion()` 或 `HealthPotionSystem.UsePotion()`
2. 系统检查使用条件
3. 计算恢复量（最大生命值 * 恢复百分比）
4. 应用生命恢复
5. 开始冷却计时

## 特性

### ✅ 已实现
- 基础血瓶配置
- 立即恢复生命
- 冷却机制
- 使用条件检查
- 支持空血瓶（没有血瓶）
- 百分比恢复
- 满血限制

### ⏳ 待实现（未来）
- AI 自动使用策略
- UI 显示
- 使用特效/音效
- 品质系统集成

## 注意事项

1. **支持空血瓶**：实体可以不配置血瓶，此时 `HasPotion()` 返回 false
2. **百分比恢复**：恢复量 = 最大生命值 × 恢复百分比 / 100
3. **自动冷却**：冷却在 `GameEntity.Update()` 中自动更新
4. **生命值上限**：恢复后的生命值不会超过最大生命值

## 测试方法

### 快速测试
```csharp
[ContextMenu("测试/使用血瓶")]
void TestUsePotion()
{
    var entity = GetComponent<GameEntity>();
    
    Debug.Log($"使用前生命值: {entity.Attributes.CurrentHealth}/{entity.Attributes.MaxHealth}");
    Debug.Log($"是否可用: {entity.HealthPotionSystem.CanUse()}");
    
    bool success = entity.UseHealthPotion();
    Debug.Log($"使用结果: {success}");
    
    if (success)
    {
        Debug.Log($"使用后生命值: {entity.Attributes.CurrentHealth}/{entity.Attributes.MaxHealth}");
        Debug.Log($"冷却时间: {entity.HealthPotionSystem.GetCooldownRemaining()}秒");
    }
}
```

## 扩展建议

### 未来可以添加
1. **品质系统**：不同品质血瓶有不同恢复量和冷却
2. **充能系统**：限制使用次数
3. **特效增强**：使用时获得短暂Buff
4. **多血瓶支持**：多个血瓶槽位

