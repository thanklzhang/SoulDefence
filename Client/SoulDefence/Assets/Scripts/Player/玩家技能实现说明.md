# 玩家技能实现说明

## 概述
根据设计文档中的要求，完整实现了玩家的所有技能系统，包括普通攻击、小招、大招、被动技能和滑行技能。

## 实现的技能

### 1. 普通攻击（PlayerBasicAttack）
**配置文件**: `Assets/Config/Skill/PlayerBasicAttack.asset`

**技能特性**:
- **攻击方式**: 近战
- **范围类型**: 扇形（Arc）
- **范围大小**: 90度扇形角度
- **目标数量**: 最多10个敌人
- **伤害计算**: 基于攻击力（100%攻击力系数）
- **冷却时间**: 1秒

**被动技能**:
- **名称**: 战斗本能
- **触发条件**: 生命值低于20% AND 每3次普通攻击
- **效果**: 
  - 增强第三次攻击伤害（1.5倍伤害倍率）
  - 恢复攻击力2%的生命值

### 2. 小招（PlayerSkill_SmallUlt）
**配置文件**: `Assets/Config/Skill/PlayerSkill_SmallUlt.asset`

**技能特性**:
- **攻击方式**: 近战
- **范围类型**: 圆形（Circle）
- **范围半径**: 5单位
- **目标数量**: 最多20个敌人
- **伤害计算**: 
  - 40%攻击力伤害
  - 10%自身最大生命值伤害
- **冷却时间**: 8秒
- **前摇时间**: 0.3秒
- **后摇时间**: 0.5秒

### 3. 大招（PlayerSkill_Ultimate）
**配置文件**: `Assets/Config/Skill/PlayerSkill_Ultimate.asset`
**Buff配置**: `Assets/Config/Effect/PlayerUltimateBuff.asset`

**技能特性**:
- **效果类型**: 状态型（Status）
- **冷却时间**: 20秒
- **前摇时间**: 0.5秒
- **持续时间**: 10秒

**Buff效果**（战斗狂热）:
- 增加20点攻击力
- 增加15点防御力
- 普通攻击获得20%吸血效果

### 4. 滑行技能（PlayerSkill_Dash）
**配置文件**: `Assets/Config/Skill/PlayerSkill_Dash.asset`

**技能特性**:
- **效果类型**: 移动型（Movement）
- **移动距离**: 5单位
- **移动时间**: 0.3秒
- **移动方式**: 冲刺（非传送）
- **冷却时间**: 5秒
- **后摇时间**: 0.2秒

## 系统扩展

### 1. 技能系统扩展（SkillData.cs & SkillSystem.cs）

#### 新增特殊伤害计算参数
- `attackPowerRatio`: 攻击力系数（如0.4表示40%攻击力）
- `targetHealthRatio`: 目标生命值百分比伤害
- `selfHealthRatio`: 自身生命值百分比伤害
- `lifeStealRatio`: 吸血比例（0-1）

#### 新增伤害计算方法
- `CalculateSkillDamage()`: 综合计算技能伤害（基础 + 攻击力系数 + 生命值百分比）
- 支持多种伤害来源的叠加计算

#### 吸血效果实现
- 技能自带吸血 + Buff提供吸血的叠加
- 根据实际造成的伤害计算吸血回复量
- 自动应用到施法者生命值

### 2. 被动技能系统扩展（PassiveSkillData.cs & PassiveSkillInstance.cs）

#### 新增效果类型
- `LifeSteal`: 吸血效果类型（PassiveEffectType.LifeSteal = 31）

#### 新增触发条件
- `requireHealthThreshold`: 是否需要满足生命值条件（用于复合触发）
- 支持"生命值低于阈值 AND 攻击次数达到阈值"的复合条件

#### 新增恢复参数
- `healFromAttackPowerRatio`: 基于攻击力的生命恢复比例
- 支持固定值恢复和百分比恢复的组合

#### 增强伤害修正逻辑
- `GetDamageModifier()`: 支持攻击次数触发的被动技能
- 对`HealthRegen`类型被动技能也支持伤害倍率
- 检查触发条件（包括生命值阈值）后应用伤害加成

### 3. Buff系统扩展（BuffData.cs, BuffEnums.cs, BuffInstance.cs & BuffSystem.cs）

#### 新增Buff效果类型
- `LifeSteal`: 吸血效果（BuffEffectType.LifeSteal = 60）
- `MultiAttributeModifier`: 多属性修改（BuffEffectType.MultiAttributeModifier = 70）

#### 新增Buff参数
- `lifeStealRatio`: 吸血比例
- `secondaryAttributeType`: 第二属性类型
- `secondaryAttributeValue`: 第二属性修改值
- `isSecondaryPercentage`: 第二属性是否百分比

#### 新增系统方法
- `GetTotalLifeStealRatio()`: 获取所有Buff提供的总吸血比例
- 扩展`GetAttributeModifiers()`: 支持多属性修改Buff

## 技能按键映射（PlayerController.cs）

根据现有的PlayerController实现：
- **鼠标左键**: 普通攻击（UseDefaultSkill）
- **F键**: 小招（UseSkill(0)）
- **V键**: 大招（UseSkill(1)）
- **Space键**: 滑行技能（需要添加到PlayerController）

## 使用方法

### 在Unity编辑器中配置玩家技能：

1. 找到玩家实体（GameEntity组件）
2. 在Inspector中设置技能列表：
   - Default Skill: PlayerBasicAttack
   - Skills[0]: PlayerSkill_SmallUlt
   - Skills[1]: PlayerSkill_Ultimate
   - Skills[2]: PlayerSkill_Dash（如果需要）

### 技能触发流程：

1. **普通攻击**:
   - 玩家按下鼠标左键
   - 系统检测前方90度扇形范围内的敌人
   - 造成100%攻击力的伤害
   - 如果生命值低于20%且是第三次攻击，触发被动技能（1.5倍伤害+回血）

2. **小招**:
   - 玩家按下F键
   - 系统检测周围5单位半径内的所有敌人
   - 造成40%攻击力 + 10%自身最大生命值的伤害

3. **大招**:
   - 玩家按下V键
   - 给自己添加"战斗狂热"Buff（持续10秒）
   - Buff效果：+20攻击力，+15防御力，普通攻击20%吸血

4. **滑行**:
   - 玩家按下对应按键（需要配置）
   - 向当前面向方向快速滑行5单位

## 技术亮点

1. **通用化设计**: 所有技能通过ScriptableObject配置，易于扩展和修改
2. **复合效果支持**: 支持技能同时具有多种效果（伤害+Buff+移动）
3. **灵活的伤害计算**: 支持多种伤害来源（固定值、攻击力系数、生命值百分比）
4. **完善的被动技能**: 支持复合触发条件和多种效果组合
5. **Buff系统增强**: 支持多属性修改和吸血效果
6. **吸血效果叠加**: 技能自带吸血和Buff吸血可以叠加

## 测试建议

1. 测试普通攻击的扇形范围和被动技能触发
2. 测试小招的范围伤害计算（攻击力+生命值百分比）
3. 测试大招Buff的属性加成和吸血效果
4. 测试滑行技能的移动距离和冷却
5. 测试被动技能在低血量时的触发和回血效果

## 注意事项

1. 技能配置文件中的GUID需要Unity自动生成，当前使用的是占位符
2. 被动技能的伤害倍率和攻击次数需要根据实际游戏平衡进行调整
3. Buff的持续时间和属性加成数值可能需要根据测试结果调整
4. 滑行技能目前没有在PlayerController中绑定按键，需要手动添加

