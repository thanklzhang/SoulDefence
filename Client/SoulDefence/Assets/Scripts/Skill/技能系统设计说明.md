# 技能系统设计说明

## 设计目标

按照游戏设计文档重构技能系统，实现简洁、灵活、易扩展的技能框架。

## 核心设计

### 技能分类体系

**按触发方式**：
- 主动技能：玩家/AI主动释放
- 被动技能：满足条件自动触发

**按效果类型**：
- 伤害型：直接造成伤害
- 状态型：添加Buff/Debuff
- 移动型：改变位置（冲刺、传送）
- 复合型：组合多种效果

**按攻击方式**：
- 近战：直接范围检测
- 远程：发射投掷物

**按范围类型**：
- 单体：最近的敌人
- 扇形：前方扇形区域
- 圆形：周围圆形区域

## 系统架构

```
SkillSystem (单例)
├── 技能执行
│   ├── ExecuteMovementSkill   移动型技能
│   ├── ExecuteDamageSkill     伤害型技能
│   └── ExecuteStatusSkill     状态型技能
├── 范围检测
│   ├── GetSingleTarget        单体目标
│   ├── GetTargetsInArc        扇形范围
│   └── GetTargetsInCircle     圆形范围
└── 伤害/Buff应用
    ├── ApplyDamage            应用伤害
    └── ApplySkillBuffs        应用Buff
```

## 技能配置（SkillData）

### 基础参数
- skillId：技能ID
- skillName：技能名称
- effectType：效果类型
- cooldown：冷却时间
- castTime：前摇时间
- recoveryTime：后摇时间

### 伤害参数
- attackType：攻击方式（近战/远程）
- rangeType：范围类型（单体/扇形/圆形）
- damage：伤害值
- rangeSize：范围大小
- targetCount：目标数量

### 状态参数
- buffToTarget：对目标的Buff
- buffToSelf：对自己的Buff

### 移动参数
- movementDistance：移动距离
- movementDuration：移动时间
- isTeleport：是否传送

### 远程参数
- projectilePrefab：投掷物预制体
- projectileSpeed：投掷物速度
- projectileLifetime：存活时间
- canThrough：是否穿透
- isFollow：是否跟踪

## 被动技能系统

### 触发类型
- None：永久生效（如属性加成）
- OnAttack：攻击时触发
- OnHit：受击时触发
- OnKill：击杀时触发
- Interval：定时触发
- OnHealthLow：生命值低时触发
- OnAttackCount：攻击次数触发

### 效果类型
- AttributeBonus：属性加成
- DamageMultiplier：伤害倍率
- ExtraDamage：额外伤害
- CriticalHit：暴击
- DamageReduction：伤害减免
- Shield：护盾
- HealthRegen：生命恢复
- Stun/Slow：控制效果

## 技能示例

### 英雄普通攻击
```
效果类型：Damage
攻击方式：Melee
范围类型：Arc（扇形60度）
伤害值：10
目标数量：3
```

### 英雄小招（复合型）
```
效果类型：Composite
攻击方式：Melee
范围类型：Circle（圆形半径3）
伤害值：基于攻击力40% + 生命值10%
Buff：减速30%，持续2秒
```

### 英雄大招（状态型）
```
效果类型：Status
Buff对自己：
  - 增加护甲20点
  - 增加攻击力30%
  - 普攻吸血20%
  - 持续5秒
```

### 英雄滑行（移动型）
```
效果类型：Movement
移动距离：5米
移动时间：0.3秒
是否传送：否（冲刺）
```

### Boss冲刺技能（复合型）
```
效果类型：Composite
移动：冲刺到目标，距离3米
伤害：单体伤害50点
```

### Boss大招（复合型）
```
效果类型：Composite
攻击方式：Melee
范围类型：Circle（圆形半径5）
伤害值：80
Buff对目标：减速50%，持续3秒
```

## 使用流程

1. **创建技能配置**：右键 → Create → GameConfig → Skill
2. **配置参数**：根据需求配置各项参数
3. **添加到实体**：在GameEntity的Skills数组中添加
4. **代码调用**：entity.UseSkill(skillData)

## 扩展性

### 添加新技能
只需创建新的SkillData配置，无需编写代码。

### 添加新效果
通过Buff系统扩展，或在技能配置中组合现有效果。

### 添加新触发条件
在PassiveSkillEnums中添加新的触发类型，在PassiveSkillInstance中实现逻辑。

### 添加新范围类型
在SkillRangeType中添加枚举，在SkillSystem中实现检测方法。

## 优势

1. **简洁**：配置清晰，代码结构简单
2. **灵活**：复合型技能支持多种效果组合
3. **易扩展**：新增技能只需配置，无需编码
4. **统一**：所有实体使用同一套技能系统
5. **完整**：支持主动和被动技能

## 注意事项

1. 攻击距离使用实体的AttackRange属性
2. 范围大小：扇形是角度，圆形是半径
3. 复合型技能可以同时包含移动、伤害、状态效果
4. 被动技能独立运行，不影响主动技能
5. 技能冷却由系统自动管理

