# 装备系统实现说明

## 文件结构

```
Equipment/
├── EquipmentEnums.cs          # 装备相关枚举定义
├── EquipmentData.cs           # 装备配置数据（ScriptableObject）
├── EquipmentInstance.cs       # 装备实例类
├── EquipmentSystem.cs         # 装备系统管理类
└── EquipmentManager.cs        # 全局装备管理器
```

## 核心类说明

### 0. Core/GameEnums.cs（通用枚举）
定义了游戏通用枚举类型：
- `Quality`: 品质（绿/蓝/紫/橙/红）- 适用于装备、道具、技能等
- `ProfessionType`: 职业类型（战士/弓手/巫师）- 通用职业定义

### 1. EquipmentEnums.cs
定义了装备系统特有的枚举类型：
- `EquipmentType`: 装备类型（武器/防具）
- `WeaponType`: 武器类型（刀/弓/法杖）
- `SkillTreeType`: 技能树类型

### 2. EquipmentData.cs
装备配置数据，使用ScriptableObject存储：
- 基础信息（ID、名称、类型等）
- 品质属性加成配置（5个品质对应的属性）
- 技能树配置（3个技能树分支）

**创建方式**：
右键 -> Create -> GameConfig -> Equipment -> Equipment Data

### 3. EquipmentInstance.cs
装备实例类，表示一个实际的装备对象：
- 当前品质
- 技能树等级分配
- 品质升级方法
- 技能树升级方法
- 属性计算方法

### 4. EquipmentSystem.cs
装备系统管理类，管理实体的武器和防具：
- 配置初始装备（在Inspector中设置）
- 初始化装备实例（内部管理）
- 提供装备属性接口
- 处理装备升级
- 处理技能树升级
- 提供奖励接口

### 5. EquipmentManager.cs
全局装备管理器（单例）：
- 管理默认装备配置
- 根据职业获取默认武器

## 使用流程

### 1. 创建装备配置

在Unity编辑器中：
1. 右键 -> Create -> GameConfig -> Equipment -> Equipment Data
2. 设置装备基础信息
3. 配置5个品质等级的属性加成
4. 配置3个技能树分支

### 2. 集成到GameEntity

装备系统已集成到`GameEntity`中：
- 在Inspector中设置`Initial Weapon`和`Initial Armor`
- 初始化时会自动创建装备实例并应用属性

### 3. 升级装备

```csharp
// 获取实体的装备系统
EquipmentSystem equipment = entity.EquipmentSystem;

// 升级武器品质
equipment.UpgradeWeaponQuality();

// 升级防具品质
equipment.UpgradeArmorQuality();

// 升级武器技能树
equipment.UpgradeWeaponSkillTree(SkillTreeType.CrazyBlade);

// 升级防具技能树
equipment.UpgradeArmorSkillTree(SkillTreeType.Tenacity);
```

### 4. 奖励系统接口

为奖励系统提供的接口：

```csharp
// 处理装备升级奖励
equipment.ProcessEquipmentUpgradeReward(
    EquipmentType.Weapon,           // 装备类型
    true,                           // 是否升级品质（false则升级技能树）
    SkillTreeType.CrazyBlade        // 技能树类型（品质升级时忽略）
);
```

## 属性系统

### 属性组合模式
**重要设计变更**：实体属性采用组合模式计算

```
实体总属性 = 基础配置属性 + 装备提供属性 + 其他加成属性
```

### EntityAttributesData（通用属性组）
所有属性使用统一的 `EntityAttributesData` 类：
- 最大生命值 (maxHealth)
- 攻击力 (attackPower)
- 防御力 (defense)
- 攻击速度 (attackSpeed)
- 移动速度 (moveSpeed)
- 攻击范围 (attackRange)
- 暴击率 (criticalRate) - 百分比
- 暴击伤害 (criticalDamage) - 百分比
- 伤害减免 (damageReduction) - 百分比

### 装备属性配置
装备的每个品质等级都使用 `EntityAttributesData` 配置：
- 武器主要提供：攻击力、攻击速度、暴击相关属性
- 防具主要提供：最大生命值、防御力、伤害减免

### 属性计算
装备属性会在以下时机触发重新计算：
1. 装备系统初始化时
2. 升级品质后
3. 升级技能树后

计算流程：
1. 从基础配置属性开始
2. 加上装备提供的属性（武器+防具）
3. 加上其他加成（Buff、技能等，待实现）
4. 缓存总属性，实体直接使用总属性

## 品质系统

### 品质等级
- 绿色（Green）：初始品质
- 蓝色（Blue）
- 紫色（Purple）
- 橙色（Orange）
- 红色（Red）：最高品质

### 升级规则
- 只能逐级升级，不能跳级
- 红色品质无法继续升级
- 升级时自动重新计算并应用属性

## 技能树系统

### 技能树结构
- 每个装备有3个技能树分支
- 每个技能树最多5级
- 技能树等级受装备品质限制

### 升级限制
- 绿色品质：技能树最高1级
- 蓝色品质：技能树最高2级
- 紫色品质：技能树最高3级
- 橙色品质：技能树最高4级
- 红色品质：技能树最高5级

### 示例技能树

**刀类武器**：
- 疯刀系（CrazyBlade）：专注输出伤害
- 魔刀系（MagicBlade）：专注攻击次数聚集效果
- 混战系（MeleeMaster）：专注大范围作战

**防具**：
- 坚韧系（Tenacity）：提升生命值与防御
- 反伤系（Reflection）：反弹部分伤害
- 恢复系（Recovery）：增加生命恢复效果

## 配置示例

### 战士之刀配置
```
equipmentId: 1001
equipmentName: 战士之刀
equipmentType: Weapon
professionRestriction: Warrior  (使用 ProfessionType 枚举)
weaponType: Sword

Quality Bonuses[0] (绿色品质):
使用 EntityAttributesData 配置：
- attackPower: 5
- attackSpeed: 2
- criticalRate: 0
- 其他属性为 0

Quality Bonuses[1-4] (蓝/紫/橙/红):
依次增加属性值

技能树：
1. 疯刀系 - 提升暴击伤害
2. 魔刀系 - 缩短触发间隔
3. 混战系 - 增加攻击范围
```

### 守护者之盾配置
```
equipmentId: 2001
equipmentName: 守护者之盾
equipmentType: Armor
professionRestriction: None  (使用 ProfessionType 枚举)

Quality Bonuses[0] (绿色品质):
使用 EntityAttributesData 配置：
- maxHealth: 50
- defense: 3
- damageReduction: 0
- 其他属性为 0

Quality Bonuses[1-4] (蓝/紫/橙/红):
依次增加属性值

技能树：
1. 坚韧系 - 提升生命值与防御
2. 反伤系 - 反弹部分伤害
3. 恢复系 - 增加生命恢复效果
```

## 待实现功能

1. **被动技能系统**：等技能系统完善后实现
2. **技能树效果计算**：目前技能树升级不影响属性，待被动技能系统完成后添加
3. **暴击系统**：需要独立的战斗计算系统支持
4. **伤害减免系统**：需要在伤害计算时应用

## 注意事项

1. 装备无法更换或删除，只能升级
2. 每个实体必须同时拥有武器和防具
3. 武器有职业限制，防具无限制
4. 装备属性修改会立即应用到实体
5. 技能树等级受品质限制，升级品质后可继续升级技能树

