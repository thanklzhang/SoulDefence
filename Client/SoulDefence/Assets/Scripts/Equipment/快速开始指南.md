# 装备系统快速开始指南

## 步骤1：创建装备配置

### 创建战士武器（刀）

1. 在Unity编辑器中，右键点击 `Assets/Config/Equipment/` 文件夹
2. 选择 `Create -> GameConfig -> Equipment -> Equipment Data`
3. 命名为 `Warrior_Sword_Green`
4. 设置以下参数：

```
equipmentId: 1001
equipmentName: 战士之刀
equipmentType: Weapon
classRestriction: Warrior
weaponType: Sword
initialQuality: Green

Quality Bonuses[0] (Green):
  quality: Green
  attackPower: 5
  attackSpeed: 2
  criticalRate: 0

Quality Bonuses[1] (Blue):
  quality: Blue
  attackPower: 10
  attackSpeed: 5
  criticalRate: 2

Quality Bonuses[2] (Purple):
  quality: Purple
  attackPower: 20
  attackSpeed: 10
  criticalRate: 5

Quality Bonuses[3] (Orange):
  quality: Orange
  attackPower: 35
  attackSpeed: 15
  criticalRate: 10

Quality Bonuses[4] (Red):
  quality: Red
  attackPower: 50
  attackSpeed: 25
  criticalRate: 15

Skill Trees[0] - 疯刀系:
  treeType: CrazyBlade
  treeName: 疯刀系
  description: 专注输出伤害，提升暴击效果
  
  Levels[0]:
    level: 1
    requiredQuality: Green
    effectDescription: 暴击伤害+20%
    effectValue: 20
    effectMultiplier: 1.2
    
  Levels[1]:
    level: 2
    requiredQuality: Blue
    effectDescription: 暴击伤害+40%
    effectValue: 40
    effectMultiplier: 1.4

  (以此类推配置Level 2-4)

Skill Trees[1] - 魔刀系:
  treeType: MagicBlade
  treeName: 魔刀系
  description: 缩短攻击间隔，提升攻击频率
  
Skill Trees[2] - 混战系:
  treeType: MeleeMaster
  treeName: 混战系
  description: 增加攻击范围，适合群体战斗
```

### 创建通用防具

1. 右键 `Assets/Config/Equipment/`
2. `Create -> GameConfig -> Equipment -> Equipment Data`
3. 命名为 `Common_Armor_Green`
4. 设置参数：

```
equipmentId: 2001
equipmentName: 守护者之盾
equipmentType: Armor
classRestriction: None
initialQuality: Green

Quality Bonuses[0] (Green):
  quality: Green
  maxHealth: 50
  defense: 3
  damageReduction: 0

Quality Bonuses[1] (Blue):
  quality: Blue
  maxHealth: 100
  defense: 6
  damageReduction: 5

(以此类推配置Purple、Orange、Red)

Skill Trees[0] - 坚韧系:
  treeType: Tenacity
  treeName: 坚韧系
  description: 提升生命值与防御力

Skill Trees[1] - 反伤系:
  treeType: Reflection
  treeName: 反伤系
  description: 反弹部分伤害给攻击者

Skill Trees[2] - 恢复系:
  treeType: Recovery
  treeName: 恢复系
  description: 增加生命恢复效果
```

## 步骤2：配置GameEntity

1. 在场景中选择你的角色实体（GameEntity）
2. 在Inspector面板中找到 `Equipment` 部分
3. 将创建的装备配置拖到对应槽位：
   - `Initial Weapon`: 拖入战士之刀配置
   - `Initial Armor`: 拖入守护者之盾配置

## 步骤3：使用装备系统

### 在代码中访问装备系统

```csharp
using SoulDefence.Equipment;

// 获取实体
GameEntity entity = GetComponent<GameEntity>();

// 获取装备系统
EquipmentSystem equipment = entity.EquipmentSystem;

// 查看当前装备品质
EquipmentQuality weaponQuality = equipment.GetWeaponQuality();
EquipmentQuality armorQuality = equipment.GetArmorQuality();

// 升级武器品质（绿->蓝）
if (equipment.Weapon.CanUpgradeQuality())
{
    equipment.UpgradeWeaponQuality();
}

// 升级武器技能树
if (equipment.Weapon.CanUpgradeSkillTree(SkillTreeType.CrazyBlade))
{
    equipment.UpgradeWeaponSkillTree(SkillTreeType.CrazyBlade);
}

// 获取当前装备属性
EquipmentAttributes weaponAttr = equipment.GetWeaponAttributes();
Debug.Log($"武器攻击力: {weaponAttr.attackPower}");
Debug.Log($"武器攻击速度加成: {weaponAttr.attackSpeed}%");

EquipmentAttributes armorAttr = equipment.GetArmorAttributes();
Debug.Log($"防具生命值加成: {armorAttr.maxHealth}");
Debug.Log($"防具防御力加成: {armorAttr.defense}");
```

### 奖励系统集成示例

```csharp
// 假设玩家击败敌人，获得装备升级奖励
public void OnEnemyKilled()
{
    // 随机选择奖励类型
    bool upgradeQuality = Random.value > 0.5f;
    EquipmentType type = Random.value > 0.5f ? EquipmentType.Weapon : EquipmentType.Armor;
    
    if (upgradeQuality)
    {
        // 升级品质
        entity.EquipmentSystem.ProcessEquipmentUpgradeReward(type, true);
    }
    else
    {
        // 随机选择一个技能树升级
        SkillTreeType[] trees = { 
            SkillTreeType.CrazyBlade, 
            SkillTreeType.MagicBlade, 
            SkillTreeType.MeleeMaster 
        };
        SkillTreeType selectedTree = trees[Random.Range(0, trees.Length)];
        
        entity.EquipmentSystem.ProcessEquipmentUpgradeReward(type, false, selectedTree);
    }
}
```

## 步骤4：配置EquipmentManager（可选）

如果需要在运行时动态分配装备：

1. 在场景中创建一个空GameObject，命名为 `EquipmentManager`
2. 添加 `EquipmentManager` 组件
3. 在Inspector中设置默认装备：
   - Default Warrior Weapon: 战士之刀
   - Default Archer Weapon: 弓手之弓（需要创建）
   - Default Wizard Weapon: 巫师法杖（需要创建）
   - Default Armor: 守护者之盾

4. 在代码中使用：

```csharp
// 获取战士的默认武器
EquipmentData warriorWeapon = EquipmentManager.Instance.GetDefaultWeaponByClass(ClassType.Warrior);
EquipmentData defaultArmor = EquipmentManager.Instance.GetDefaultArmor();

// 初始化装备
equipmentSystem.Initialize(entity, warriorWeapon, defaultArmor);
```

## 注意事项

1. **必须配置完整**：每个装备必须配置所有5个品质等级和3个技能树
2. **品质按顺序**：Quality Bonuses数组索引必须与品质等级对应（0=Green, 1=Blue...）
3. **技能树限制**：技能树等级受装备品质限制，确保配置合理
4. **属性单位**：
   - 攻击速度、暴击率、伤害减免使用百分比（0-100）
   - 其他属性使用实际数值
5. **保存配置**：修改配置后记得保存（Ctrl+S）

## 测试建议

创建一个测试脚本来验证装备系统：

```csharp
[ContextMenu("测试装备系统")]
void TestEquipmentSystem()
{
    var equipment = GetComponent<GameEntity>().EquipmentSystem;
    
    Debug.Log("=== 初始状态 ===");
    Debug.Log($"武器品质: {equipment.GetWeaponQuality()}");
    Debug.Log($"防具品质: {equipment.GetArmorQuality()}");
    
    Debug.Log("\n=== 升级武器品质 ===");
    equipment.UpgradeWeaponQuality();
    Debug.Log($"武器品质: {equipment.GetWeaponQuality()}");
    
    Debug.Log("\n=== 升级技能树 ===");
    equipment.UpgradeWeaponSkillTree(SkillTreeType.CrazyBlade);
    Debug.Log($"疯刀系等级: {equipment.Weapon.GetSkillTreeLevel(SkillTreeType.CrazyBlade)}");
    
    Debug.Log("\n=== 当前属性 ===");
    var attr = equipment.GetWeaponAttributes();
    Debug.Log($"攻击力: {attr.attackPower}");
    Debug.Log($"攻击速度: {attr.attackSpeed}%");
    Debug.Log($"暴击率: {attr.criticalRate}%");
}
```

在Unity编辑器中右键点击组件，选择"测试装备系统"即可运行测试。

