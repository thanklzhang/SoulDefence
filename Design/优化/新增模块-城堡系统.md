# 新增模块：城堡系统

## 为什么必须有

这是**守城游戏**的核心系统！
- 城堡是玩家的防守目标
- 敌人的最终目标是摧毁城堡
- 城堡生命值归0 = 游戏失败

---

## 1. 城堡属性

### 1.1 基础属性
- **最大生命值**：1000（初始值，可升级）
- **当前生命值**：1000
- **攻击力**：20（初始值，可升级）
- **攻击速度**：1次/秒（可升级）
- **攻击范围**：10米（可升级）
- **防御力**：5（可升级）

### 1.2 属性说明
- 生命值：城堡的耐久度，归0则游戏失败
- 攻击力：城堡对敌人造成的伤害
- 攻击速度：城堡攻击的频率
- 攻击范围：城堡能攻击到的距离
- 防御力：减少受到的伤害

---

## 2. 城堡行为

### 2.1 基础行为
- **固定位置**：城堡位于地图中心，不可移动
- **自动攻击**：自动攻击范围内的敌人
- **受击**：敌人攻击城堡会减少城堡生命值
- **死亡**：生命值归0时游戏失败

### 2.2 攻击机制
- **目标选择**：优先攻击范围内最近的敌人
- **攻击方式**：发射炮弹（远程攻击）
- **伤害计算**：城堡攻击力 - 敌人防御力
- **攻击间隔**：根据攻击速度计算

### 2.3 受击机制
- **受击伤害**：敌人攻击力 - 城堡防御力
- **受击反馈**：播放受击音效+特效
- **血量警告**：生命值低于30%时红色警告

---

## 3. 城堡升级

### 3.1 升级途径

#### 方式1：奖励系统
击杀怪物掉落宝箱，3选1时可能出现：
- 城堡生命值 +200
- 城堡攻击力 +30%
- 城堡攻击范围 +3米
- 城堡攻击速度 +20%
- 城堡立即恢复50%生命值

#### 方式2：商店系统
按B键打开强化站，随机4个选项中可能包含：
- 城堡生命（100金币）：最大生命值 +200
- 城堡火力（100金币）：攻击力 +30%
- 城堡恢复（100金币）：立即恢复生命值50%

### 3.2 升级类型

**永久升级**
- 最大生命值提升
- 攻击力提升
- 攻击速度提升
- 攻击范围提升
- 防御力提升

**即时效果**
- 立即恢复生命值
- 临时护盾（吸收伤害）
- 临时攻击力加成

---

## 4. UI显示

### 4.1 常驻UI
- **位置**：屏幕顶部中央
- **显示内容**：
  - 城堡图标
  - 当前生命值/最大生命值（如：800/1000）
  - 生命值百分比条（绿色→黄色→红色）

### 4.2 状态提示
- **正常**：血条绿色
- **受损**：血条黄色（生命值<60%）
- **危险**：血条红色+闪烁（生命值<30%）
- **受击时**：血条闪烁+受击特效

### 4.3 详细信息（可选）
按Tab键查看城堡详细信息：
- 攻击力
- 攻击速度
- 攻击范围
- 防御力

---

## 5. 战斗表现

### 5.1 攻击表现
- **攻击动画**：城堡炮台转向目标
- **发射特效**：炮弹发射光效
- **炮弹飞行**：炮弹从城堡飞向敌人
- **命中特效**：炮弹击中敌人爆炸
- **伤害数字**：显示造成的伤害

### 5.2 受击表现
- **受击音效**：城堡被攻击的音效
- **受击特效**：城堡闪红光
- **屏幕震动**：城堡受到重击时
- **血条抖动**：生命值减少动画

### 5.3 危险提示
当城堡生命值<30%时：
- 屏幕边缘红色警告
- 警报音效循环播放
- 血条快速闪烁
- 提示文字："城堡危险！"

---

## 6. 平衡设计

### 6.1 初始数值
- 最大生命值：1000
- 攻击力：20
- 攻击速度：1次/秒
- 攻击范围：10米
- 防御力：5

### 6.2 升级数值
- 生命值升级：每次+200（最多升级5次，最大2000）
- 攻击力升级：每次+30%（最多升级4次）
- 攻击速度升级：每次+20%（最多升级3次）
- 攻击范围升级：每次+3米（最多升级3次，最大19米）

### 6.3 难度平衡
- 前期：敌人弱，城堡可以轻松守住
- 中期：敌人变强，玩家需要兼顾城堡和自身
- 后期：敌人很强，城堡需要升级才能撑住

---

## 7. 特殊机制（可选）

### 7.1 城堡技能（未来扩展）
- **炮击轰炸**：对范围内所有敌人造成伤害（冷却60秒）
- **护盾展开**：城堡获得护盾，吸收伤害（冷却90秒）

### 7.2 城堡状态（未来扩展）
- **火力模式**：攻击力+50%，攻击速度+50%，持续30秒
- **防御模式**：防御力+100%，生命恢复，持续30秒

---

## 8. 失败条件

### 8.1 失败判定
城堡生命值归0时，游戏立即失败

### 8.2 失败表现
- 城堡爆炸特效
- 屏幕震动
- 失败音效
- 显示"城堡被摧毁！游戏失败"
- 显示游戏统计（击杀数、存活时间等）

---

## 9. 技术实现要点

### 9.1 城堡实体
- 继承自实体基类
- 固定位置，不可移动
- 拥有攻击行为和AI
- 拥有生命值和属性系统

### 9.2 数据配置
使用ScriptableObject配置：
- 初始属性
- 升级数值
- 攻击效果
- 特效和音效

### 9.3 与其他系统的关系
- **关卡系统**：城堡死亡触发失败
- **奖励系统**：提供城堡升级选项
- **商店系统**：提供城堡强化选项
- **UI系统**：显示城堡状态

